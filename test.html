<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Matchday - Petriolese Calcio</title>
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<style>
  :root{
    --pitch-bottom: 14%;
    --subs-gap:      8%;
    --bg:#0b0c11;
    --roof-dark:#151923;
    --roof-mid:#1f2531;
    --roof-glow:rgba(255,255,255,.08);

    --grass-1:#0a6f20; --grass-2:#0d7f26;

    /* Giocatori / badge */
    --photo-h: 20cqh;
    --badge-w: 16cqh;
    --badge-font: min(1.8cqh, 2.3cqw);
    --badge-overlap: 1.4cqh;

    /* SUBS (elenco) */
    --subs-font:  min(1.6cqh, 2.1cqw);
    --subs-weight: 800;
    --subs-tracking: .18cqw;
    --subs-line: 1.15;
    --subs-transform: uppercase;
    --subs-maxw: calc(100% - 6cqw);
    --subs-font-family: system-ui, Arial, sans-serif;
    --subs-drop: 1cqh;

    /* pennellate */
    --brush-bleed-y: 2cqh;

    /* MATCHDAY */
    --md-w: 88cqw;
    --md-font-top: 3.6cqw;
    --md-font-sub: 2.2cqw;
    --md-splat-bleed: 2.2cqh;

    /* VS */
    --vs-w: 88cqw;
    --vs-logo-h: 10cqh;
    --vs-gap: 2cqw;
    --vs-font: 2.2cqw;
    --vs-letter: .18cqw;

    /* Stack FABs */
    --fab-stack-gap: clamp(8px, 1.6cqw, 12px);
  }

  html,body{height:100%}
  body{
    margin:0; background:var(--bg);
    display:grid; place-items:center;
    font-family:system-ui,Arial,sans-serif;
  }

  .stage{
    position:relative;
    width:min(1200px,96vw);
    aspect-ratio:9/16;
    max-height:96vh;
    overflow:hidden;
    border-radius:18px;
    background:#0b0c11;
    box-shadow:0 25px 80px rgba(0,0,0,.6);
    container-type:size; /* abilita cqw/cqh e @container */
  }

  /* Fondale stadio */
  .stadium{
    position:absolute; inset:0; z-index:0;
    background:
      radial-gradient(1200px 220px at 50% -40px, var(--roof-glow), transparent 60%),
      linear-gradient(to bottom, var(--roof-mid) 0%, var(--roof-dark) 48%, #061007 100%);
  }

  /* Strisce oblique */
  .roof-stripes{ position:absolute; inset:0; z-index:1; pointer-events:none; display:block; }

  /* Campo (SVG con clipPath) */
  .pitch-wrap{
    position:absolute; left:50%; bottom:var(--pitch-bottom); transform:translateX(-50%);
    width:100%; height:75%;
    z-index:2;
  }
  #pitch{ position:absolute; inset:0; width:100%; height:100%; display:block; }

  /* Giocatori */
  .players{
    position:absolute; left:50%; bottom:var(--pitch-bottom); transform:translateX(-50%);
    width:100%; height:75%;
    overflow:visible; pointer-events:none;
    container-type:size; z-index:3;
  }
  .player{ position:absolute; left:0; top:0; transform:translate(-50%, -100%); display:block; overflow:visible; }
  .player .photo{ height: var(--photo-h); width:auto; position:relative; display:block; z-index:1; }

  .badge{
    position:absolute; left:50%; top: calc(100% - var(--badge-overlap));
    transform: translateX(-50%);
    display:flex; align-items:center; justify-content:center;
    width: var(--badge-w); aspect-ratio: 5.5/1;
    font-size: var(--badge-font); font-weight: 900;
    background: url('badge.png?v=6') center/100% auto no-repeat;
    color:#000; white-space:nowrap; line-height:1; pointer-events:none; z-index:2;
  }

  /* MATCHDAY */
  .matchday-badge{
    position:absolute; transform: translate(-50%, -50%);
    width: var(--md-w); aspect-ratio: 5.5/1;
    display:flex; align-items:center; justify-content:center;
    background:none; overflow:visible; pointer-events:none; z-index:4;
  }
  .matchday-badge::before{
    content:""; position:absolute; left:50%; top:50%; transform: translate(-50%,-50%);
    width:100%; height: calc(100% + var(--md-splat-bleed) * 2);
    background: url('md-splat.webp') center / contain no-repeat; z-index:-1; pointer-events:none;
  }
  .matchday-text{ display:flex; flex-direction:column; align-items:center; gap:.35cqh; color:#fff; font-weight:900; text-transform:uppercase; letter-spacing:.22cqw; line-height:1.05; text-align:center; }
  .matchday-text .md-top{ font-size: var(--md-font-top); }
  .matchday-text .md-sub{ font-size: var(--md-font-sub); letter-spacing:.18cqw; }

  /* VS */
  .versus-badge{
    position:absolute; transform: translate(-50%, -50%);
    width: var(--vs-w);
    display:flex; align-items:center; justify-content:center; gap: var(--vs-gap);
    background:none; overflow:visible; pointer-events:none; z-index:4;
  }
  .versus-badge .team-logo{ height: var(--vs-logo-h); width:auto; object-fit:contain; image-rendering:auto; display:block; }
  .versus-badge .vs-text{ color:#fff; font-weight:900; text-transform:uppercase; font-size: var(--vs-font); letter-spacing: var(--vs-letter); line-height:1; display:block; }

  /* SUBS */
  .subs-badge{
    position:absolute; bottom: var(--pitch-bottom);
    transform: translate(-50%, calc(50% + var(--subs-drop)));
    width: 30cqw; aspect-ratio: 5.5/1;
    display:flex; align-items:center; justify-content:center;
    background:none; overflow:visible; color:#fff; font-weight:900; text-transform:uppercase;
    font-size: min(1.6cqh, 2.1cqw); letter-spacing:.18cqw; padding: 0 .8cqw;
    pointer-events:none; z-index:4;
  }
  .subs-badge::before{
    content:""; position:absolute; left:50%; top:50%; transform: translate(-50%,-50%);
    width:100%; height: calc(100% + var(--brush-bleed-y) * 2);
    background: url('badge-bg.webp') center / contain no-repeat; z-index:-1; pointer-events:none;
  }
  .subs-zone{
    position:absolute; left:0; right:0; bottom:0; height: var(--pitch-bottom);
    display:flex; align-items:center; justify-content:center; padding: 0 2cqw; pointer-events:none; z-index:4;
  }
  .subs-zone .subs-list{
    margin:0 auto; max-width: var(--subs-maxw);
    text-align:center; white-space:normal; overflow-wrap:anywhere;
    font-family: var(--subs-font-family);
    font-size: var(--subs-font); font-weight: var(--subs-weight);
    letter-spacing: var(--subs-tracking); line-height: var(--subs-line);
    text-transform: var(--subs-transform); color:#fff; opacity:.95;
  }

  @container (max-width: 520px){
    .stage{ --subs-font: clamp(16px, 3cqh, 4.2cqw); --subs-tracking: .10cqw; --subs-maxw: 100%; }
    .subs-zone{ padding: 0 .8cqw; }
  }

  /* ===== FAB Share (Material bianco, quadrato) ===== */
  .fab-share{
    --fab-size: clamp(36px, 10cqw, 48px);
    --fab-edge: clamp(10px, 2cqw, 16px);
    --fab-radius: 12px;

    position:absolute; top:var(--fab-edge); left:var(--fab-edge);
    width:var(--fab-size); height:var(--fab-size);
    display:grid; place-items:center;

    border: 1px solid rgba(0,0,0,.08);
    border-radius: var(--fab-radius);
    background:#fff;  color:#111;
    box-shadow: 0 2px 4px rgba(0,0,0,.18), 0 8px 16px rgba(0,0,0,.16);
    cursor:pointer; z-index:10;

    transition: transform .15s ease, box-shadow .15s ease,
                background-color .15s ease, opacity .15s ease, border-color .15s ease;
  }
  .fab-share:hover{ transform: translateY(-1px); background:#f5f6f8; box-shadow: 0 3px 6px rgba(0,0,0,.20), 0 12px 20px rgba(0,0,0,.18); }
  .fab-share:active{ transform: translateY(0); background:#eceef2; }
  .fab-share:focus-visible{ outline: 3px solid rgba(66,133,244,.55); outline-offset: 2px; }
  .fab-share[aria-busy="true"]{ pointer-events:none; opacity:.7 }
  .fab-share svg{ width: calc(var(--fab-size) * .56); height: calc(var(--fab-size) * .56); fill: currentColor; }

  /* ===== FAB Instagram ===== */
  .fab-ig{
    --fab-size: clamp(36px, 10cqw, 48px);
    --fab-edge: clamp(10px, 2cqw, 16px);
    --fab-radius: 12px;

    position:absolute;
    top: calc(var(--fab-edge) + var(--fab-size) + var(--fab-stack-gap));
    left: var(--fab-edge);
    width:var(--fab-size); height:var(--fab-size);
    display:grid; place-items:center;

    border: 1px solid rgba(0,0,0,.08);
    border-radius: var(--fab-radius);
    background:#fff; color:#111;
    box-shadow: 0 2px 4px rgba(0,0,0,.18), 0 8px 16px rgba(0,0,0,.16);
    cursor:pointer; z-index:10;

    transition: transform .15s ease, box-shadow .15s ease,
                background-color .15s ease, opacity .15s ease, border-color .15s ease;
  }
  .fab-ig:hover{ transform: translateY(-1px); background:#f5f6f8; box-shadow: 0 3px 6px rgba(0,0,0,.20), 0 12px 20px rgba(0,0,0,.18); }
  .fab-ig:active{ transform: translateY(0); background:#eceef2; }
  .fab-ig:focus-visible{ outline: 3px solid rgba(66,133,244,.55); outline-offset: 2px; }
  .fab-ig svg{
    width: calc(var(--fab-size) * .56);
    height: calc(var(--fab-size) * .56);
    fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
  }
  .fab-ig::after{
    content:"↗"; position:absolute; top:2px; right:2px;
    font-size: calc(var(--fab-size) * .28);
    color: currentColor; opacity:.55; line-height:1;
    pointer-events:none;
  }

  /* FABs più piccoli su mobile */
  @container (max-width: 520px){
    .fab-share,
    .fab-ig{
      --fab-size: clamp(24px, 7cqw, 34px);
      --fab-edge: clamp(8px, 1.6cqw, 12px);
      --fab-radius: 10px;
    }
    .fab-ig{ top: calc(var(--fab-edge) + var(--fab-size) + var(--fab-stack-gap)); }
    .fab-share svg,
    .fab-ig   svg{
      width: calc(var(--fab-size) * .50);
      height: calc(var(--fab-size) * .50);
    }
  }

  /* EXPORT MODE */
  .stage.is-capturing{ border-radius:0 !important; box-shadow:none !important; background:#0b0c11 !important; }
  .stage.is-capturing svg{ shape-rendering: geometricPrecision; }
  .stage.is-capturing #lines > *{ stroke-width: 3.6px !important; }

  /* BOOST MATCHDAY mobile */
  @container (max-width: 520px){
    .matchday-badge{ --md-w: 96cqw; --md-splat-bleed: 3.2cqh; }
    .matchday-text{ letter-spacing: .20cqw; }
    .matchday-text .md-top{ font-size: clamp(20px, 5cqw, 34px); }
    .matchday-text .md-sub{ font-size: clamp(14px, 3.2cqw, 22px); letter-spacing: .16cqw; }
  }

  /* COMPACT VS mobile */
  @container (max-width: 520px){
    .versus-badge{
      --vs-gap: .8cqw;
      --vs-logo-h: 8.2cqh;
      --vs-font: clamp(22px, 4.2cqw, 36px);
      --vs-letter: .22cqw;
    }
  }

  /* SUBS badge BOOST su mobile */
  @container (max-width: 520px){
    .stage{ --brush-bleed-y: 3.4cqh; }
    .subs-badge{
      width: 40cqw;
      font-size: clamp(14px, 3.3cqw, 20px);
      letter-spacing: .22cqw;
      padding: 0 1cqw;
    }
  }

  /* Fallback senza container queries */
  @supports not (width: 1cqw){
    @media (max-width: 520px){
      .matchday-badge{ width: min(96vw, 96%); }
      .matchday-text .md-top{ font-size: clamp(20px, 5vw, 34px); }
      .matchday-text .md-sub{ font-size: clamp(14px, 3.2vw, 22px); }
      .versus-badge .team-logo{ height: 9vh; }
      .versus-badge{ gap: 1.5vw; }
      .versus-badge .vs-text{ font-size: clamp(22px, 4.2vw, 36px); letter-spacing: .22vw; }
      .subs-badge{ width: 40vw; font-size: clamp(14px, 3.3vw, 20px); letter-spacing: .22vw; padding: 0 1vw; }
    }
  }
</style>
</head>
<body>
  <div class="stage">
    <div class="stadium"></div>

    <!-- Strisce oblique tetto/gradoni -->
    <svg class="roof-stripes" viewBox="0 0 1000 1778" preserveAspectRatio="none" aria-hidden="true">
      <defs>
        <pattern id="diag" patternUnits="userSpaceOnUse" width="44" height="44" patternTransform="rotate(-10)">
          <rect x="0" y="0" width="44" height="14" fill="#ffffff" opacity="0.06"/>
          <rect x="0" y="14" width="44" height="30" fill="transparent"/>
        </pattern>
      </defs>
      <rect x="0" y="0" width="1000" height="1778" fill="url(#diag)"/>
    </svg>

    <!-- MATCHDAY -->
    <div id="matchdayBadge" class="matchday-badge">
      <div class="matchday-text">
        <div class="md-top">MATCHDAY</div>
        <div class="md-sub" id="mdSub"></div>
      </div>
    </div>

    <!-- VS -->
    <div id="versusBadge" class="versus-badge">
      <img id="logo1" class="team-logo" alt="" crossorigin="anonymous">
      <span class="vs-text">VS</span>
      <img id="logo2" class="team-logo" alt="" crossorigin="anonymous">
    </div>

    <!-- Campo -->
    <div class="pitch-wrap">
      <svg id="pitch" viewBox="0 0 1000 1000" preserveAspectRatio="none" aria-hidden="false">
        <defs>
          <clipPath id="clipPitch" clipPathUnits="userSpaceOnUse">
            <polygon points="120,120 880,120 1000,1000 0,1000"/>
          </clipPath>

          <!-- Gradiente prato -->
          <linearGradient id="grassGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%"  stop-color="#0d7f26"/>
            <stop offset="100%" stop-color="#0a6f20"/>
          </linearGradient>

          <!-- Bande 50/50 allineate top e bottom (880 = 8 × 110) -->
          <pattern id="mow"
                   patternUnits="userSpaceOnUse"
                   width="1000" height="110"
                   patternTransform="translate(0,120)">
            <rect x="0" y="0"  width="1000" height="55" fill="#ffffff" opacity="0.12"/>
            <rect x="0" y="55" width="1000" height="55" fill="transparent"/>
          </pattern>
        </defs>

        <!-- Prato con clip trapezoidale -->
        <g clip-path="url(#clipPitch)">
          <rect x="0" y="0" width="1000" height="1000" fill="url(#grassGrad)"/>
          <rect x="0" y="0" width="1000" height="1000" fill="url(#mow)"/>
        </g>

        <!-- Linee campo -->
        <g id="lines" clip-path="url(#clipPitch)" stroke="white" fill="none"></g>
      </svg>
    </div>

    <!-- Giocatori -->
    <div class="players" id="players"></div>

    <!-- SUBS -->
    <div id="subsBadge" class="subs-badge">SUBS</div>

    <!-- Elenco panchina -->
    <div class="subs-zone">
      <div class="subs-list" id="subsList"></div>
    </div>

    <!-- FAB Share -->
    <button id="shareFab" class="fab-share" title="Condividi" aria-label="Condividi">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a3.2 3.2 0 000-1.39l7-4.11a2.5 2.5 0 10-.9-1.45l-7 4.11a2.5 2.5 0 100 4.07l7.05 4.14a2.5 2.5 0 101.94-2z"/>
      </svg>
    </button>

    <!-- FAB Instagram -->
    <button id="igFab" class="fab-ig" title="Apri Instagram @asd_petriolese_calcio" aria-label="Apri Instagram @asd_petriolese_calcio">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <rect x="3" y="3" width="18" height="18" rx="5" ry="5"></rect>
        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
        <circle cx="17.5" cy="6.5" r="1.2"></circle>
      </svg>
    </button>
  </div>

<script>
/* ====== DISEGNO CAMPO ====== */
const W=68,H=105,areaW=40.32,areaD=16.5,goalW=18.32,goalD=5.5,spot=11,R=9.15;
/* Trapezio coerente con lo SVG */
const TL={x:120,y:120}, TR={x:880,y:120}, BL={x:0,y:1000}, BR={x:1000,y:1000};
const lerp=(a,b,t)=>({x:a.x+(b.x-a.x)*t, y:a.y+(b.y-a.y)*t});
function map(u,v){const t=v/H, L=lerp(TL,BL,t), Rr=lerp(TR,BR,t), s=u/W; return {x:L.x+(Rr.x-L.x)*s, y:L.y+(Rr.y-L.y)*s};}
const G=document.getElementById('lines');
function addPolyline(p
