<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Countdown ‚Äì Petriolese Calcio</title>
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<style>
  :root{
    --bg:#0b0c11; --roof-dark:#151923; --roof-mid:#1f2531; --roof-glow:rgba(255,255,255,.08);
    --fab-stack-gap: clamp(8px, 1.6cqw, 12px);
    --vs-gap: 1.4cqw;

    /* badge ‚Äúsplat‚Äù dietro al titolo */
    --md-w: 72cqw;
    --md-splat-bleed: 2.2cqh;
  }
  html,body{height:100%}
  body{margin:0;background:var(--bg);display:grid;place-items:center;font-family:system-ui,Arial,sans-serif}

  .stage{
    position:relative; width:min(1200px,96vw); aspect-ratio:9/16; max-height:96vh;
    overflow:hidden; border-radius:18px; background:#0b0c11; box-shadow:0 25px 80px rgba(0,0,0,.6);
    container-type:size;
  }

  /* === Video di sfondo === */
  #bg-video{
    position:absolute; inset:0;
    width:100%; height:100%; object-fit:cover;
    z-index:0;
    filter:brightness(.32) contrast(1.05) saturate(1.05);
    background:#0b0c11;
  }

  /* Overlay/atmosfera sopra al video (semi-trasparente) */
  .stadium{
    position:absolute; inset:0; z-index:1; pointer-events:none;
    background:
      radial-gradient(1200px 220px at 50% -40px, var(--roof-glow), rgba(0,0,0,0) 60%),
      linear-gradient(to bottom, rgba(31,37,49,.66) 0%, rgba(21,25,35,.78) 48%, rgba(6,16,7,.92) 100%);
  }
  .roof-stripes{ position:absolute; inset:0; z-index:2; pointer-events:none; display:block; }

  .wrap{
    position:absolute; inset:0; z-index:4;
    display:grid; grid-template-rows:auto 1fr auto; align-items:center; justify-items:center;
    padding: 4cqh 3cqw;
  }

  .title-badge{
    position:relative; width: var(--md-w); aspect-ratio: 5.5/1;
    display:grid; place-items:center; overflow:visible; pointer-events:none;
  }
  .title-badge::before{
    content:""; position:absolute; left:50%; top:50%; transform: translate(-50%,-50%);
    width:100%; height: calc(100% + var(--md-splat-bleed) * 2);
    background: url('md-splat.webp') center / contain no-repeat;
    z-index:-1; pointer-events:none;
    filter: drop-shadow(0 16px 40px rgba(0,0,0,.35));
  }
  .title{
    color:#fff; font-weight:900; text-transform:uppercase; letter-spacing:.22cqw;
    font-size: clamp(18px, 3.8cqw, 34px); text-align:center;
  }
  /* sottotitoli sotto al titolo principale */
.subtitle{
  margin-top: .4cqh;
  color:#e9edf5;
  font-weight:900;
  text-transform:uppercase;
  letter-spacing:.18cqw;
  text-align:center;
  font-size: clamp(14px, 2.4cqw, 20px);
  opacity:.96;
}
.subtitle.small{
  margin-top: .2cqh;
  font-size: clamp(12px, 2.0cqw, 16px);
  opacity:.9;
}
  .vs-block{
    margin-top: 2cqh;
    display:grid; grid-auto-rows: min-content; row-gap: 1.2cqh;
    width: 100%;
  }

  .team-row{
    display:flex; align-items:center; gap: var(--vs-gap);
    color:#fff; font-weight:900; text-transform:uppercase; letter-spacing:.18cqw;
    font-size: clamp(18px, 2.8cqw, 28px);
  }
  .team-row .team-logo{ height: 8.6cqh; width:auto; object-fit:contain; display:block; }
  .team-row.top{ justify-self:start; margin-left: 6cqw; }
  .team-row.bottom{ justify-self:end; margin-right: 6cqw; }

  /* VS immagine spennellata */
  .vs-center{ justify-self:center; display:grid; place-items:center; }
  .vs-img{ height: clamp(54px, 12cqh, 160px); width:auto; display:block;
           filter: drop-shadow(0 8px 18px rgba(0,0,0,.35)); }

  .countdown{
    margin-top: 2.8cqh;
    color:#fff; font-weight:900; letter-spacing:.22cqw; line-height:1;
    font-size: clamp(24px, 5.6cqw, 54px);
    white-space: nowrap; text-align:center;
  }

  .meta{
    margin-top: 1.6cqh; color:#cfd3dc; text-align:center; opacity:.95;
    font-size: clamp(14px, 2.2cqw, 18px); letter-spacing:.06cqw;
  }

  /* Pill posizione: sempre una riga */
  .venue{
    margin-top: 1.0cqh;
    display: inline-flex;
    align-items: center;
    gap: .6cqw;
    padding: .7cqh 1.2cqw;
    border-radius: 999px;
    background: rgba(255,255,255,.08);
    box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset;
    white-space: nowrap;
    max-width: 92cqw;
    overflow: hidden;
  }
  .venue .pin{ filter: drop-shadow(0 1px 0 rgba(0,0,0,.25)); flex: 0 0 auto; }
  .venue a{
    color:#e6ebf2; text-decoration:none; font-weight:700;
    letter-spacing:.04cqw; font-size: clamp(13px, 2.2cqw, 16px);
    display:inline-block;
    overflow:hidden; text-overflow:ellipsis;
    max-width: calc(92cqw - 4cqw);
  }
  .venue a:hover{ text-decoration:underline; }

  /* FABs */
  .fab{
    --fab-size: clamp(36px, 10cqw, 48px);
    --fab-edge: clamp(10px, 2cqw, 16px);
    --fab-radius: 12px;

    position:absolute; top:var(--fab-edge); left:var(--fab-edge);
    width:var(--fab-size); height:var(--fab-size);
    display:grid; place-items:center;

    border: 1px solid rgba(0,0,0,.08);
    border-radius: var(--fab-radius);
    background:#fff; color:#111;
    box-shadow: 0 2px 4px rgba(0,0,0,.18), 0 8px 16px rgba(0,0,0,.16);
    cursor:pointer; z-index:10;

    transition: transform .15s ease, box-shadow .15s ease, background-color .15s ease, opacity .15s ease, border-color .15s ease;
  }
  .fab:hover{ transform: translateY(-1px); background:#f5f6f8; box-shadow: 0 3px 6px rgba(0,0,0,.20), 0 12px 20px rgba(0,0,0,.18); }
  .fab:active{ transform: translateY(0); background:#eceef2; }
  .fab:focus-visible{ outline: 3px solid rgba(66,133,244,.55); outline-offset: 2px; }
  .fab[aria-busy="true"]{ pointer-events:none; opacity:.7 }
  .fab svg{ width: calc(var(--fab-size) * .56); height: calc(var(--fab-size) * .56); }

  .fab-ig{ top: calc(var(--fab-edge) + var(--fab-size) + var(--fab-stack-gap)); }
  .fab-wa{ top: calc(var(--fab-edge) + (var(--fab-size) + var(--fab-stack-gap)) * 2); }

  @container (max-width: 520px){
    .fab{ --fab-size: clamp(24px, 7cqw, 34px); --fab-edge: clamp(8px, 1.6cqw, 12px); --fab-radius: 10px; }
    .fab svg{ width: calc(var(--fab-size) * .50); height: calc(var(--fab-size) * .50); }
  }
</style>
</head>
<body>
  <div class="stage">
    <!-- üé• Video di sfondo -->
    <video id="bg-video" autoplay muted loop playsinline preload="metadata">
      <source src="video_2025-09-02_23-14-49.mp4" type="video/mp4">
    </video>

    <!-- Overlay/atmosfera -->
    <div class="stadium"></div>

    <!-- Strisce diagonali -->
    <svg class="roof-stripes" viewBox="0 0 1000 1778" preserveAspectRatio="none" aria-hidden="true">
      <defs>
        <pattern id="diag" patternUnits="userSpaceOnUse" width="44" height="44" patternTransform="rotate(-10)">
          <rect x="0" y="0" width="44" height="14" fill="#ffffff" opacity="0.06"/>
          <rect x="0" y="14" width="44" height="30" fill="transparent"/>
        </pattern>
      </defs>
      <rect x="0" y="0" width="1000" height="1778" fill="url(#diag)"/>
    </svg>

    <div class="wrap">
      <!-- Titolo -->
      <div class="title-badge">
        <div class="title">Prossima partita</div>
        <div class="subtitle" id="giornataLine" hidden></div>
        <div class="subtitle small" id="compLine" hidden></div>
      </div>

      <div class="vs-block">
        <!-- Riga 1 -->
        <div class="team-row top">
          <img id="logo1" class="team-logo" alt="" />
          <span id="t1">Petriolese</span>
        </div>

        <!-- Riga 2: immagine VS -->
        <div class="vs-center">
          <img src="vs-brush.webp" alt="VS" class="vs-img" />
        </div>

        <!-- Riga 3 -->
        <div class="team-row bottom">
          <span id="t2">‚Äî</span>
          <img id="logo2" class="team-logo" alt="" />
        </div>
      </div>

      <div class="countdown" id="countdownLine">‚Äî</div>
      <div class="meta" id="metaLine">In attesa di data/ora‚Ä¶</div>

      <!-- Pill posizione -->
      <div class="venue" id="venueBox" hidden>
        <span class="pin" aria-hidden="true">üìç</span>
        <a id="venueLink" target="_blank" rel="noopener">Campo da definire</a>
      </div>
    </div>

    <!-- FABs -->
    <button id="shareFab" class="fab fab-share" title="Condividi" aria-label="Condividi">
      <!-- Share icon -->
      <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a3.2 3.2 0 000-1.39l7-4.11a2.5 2.5 0 10-.9-1.45l-7 4.11a2.5 2.5 0 100 4.07l7.05 4.14a2.5 2.5 0 101.94-2z"/>
      </svg>
    </button>

    <button id="igFab" class="fab fab-ig" title="Apri Instagram @asd_petriolese_calcio" aria-label="Apri Instagram @asd_petriolese_calcio">
      <!-- Instagram glyph -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <rect x="3" y="3" width="18" height="18" rx="5" ry="5"></rect>
        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
        <circle cx="17.5" cy="6.5" r="1.2"></circle>
      </svg>
    </button>

    <button id="waFab" class="fab fab-wa" title="Apri canale WhatsApp" aria-label="Apri canale WhatsApp">
      <!-- WhatsApp glyph -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M20.5 11.9c0 4.73-3.86 8.56-8.62 8.56a8.6 8.6 0 0 1-4.46-1.26L3.5 20.5l1.37-3.8a8.52 8.52 0 0 1-1.0-3.8C3.87 8.18 7.73 4.35 12.49 4.35c4.76 0 8.02 3.83 8.02 7.55Z"/>
        <path d="M9.3 8.9c-.24.12-.8.59-.8 1.39 0 .8.5 1.58.57 1.68.09.12 1.57 2.52 4.02 3.48 2.46.96 2.46.64 2.91.62.45-.02 1.44-.59 1.64-1.16.2-.57.2-1.07.14-1.18-.06-.11-.22-.17-.47-.3-.25-.12-1.44-.71-1.66-.79-.22-.08-.38-.12-.54.12-.16.24-.63.79-.77.95-.14.16-.28.18-.53.06-.25-.12-1.05-.39-2.0-1.24-.74-.64-1.23-1.43-1.38-1.67-.14-.24-.01-.37.11-.49.11-.11.25-.3.37-.45.12-.16.16-.24.24-.41.08-.16.04-.3-.02-.42-.06-.12-.54-1.3-.74-1.77-.2-.46-.4-.39-.54-.39-.14 0-.3 0-.54.12Z"/>
      </svg>
    </button>
  </div>

<script>
/* ====== SHEET CONFIG ====== */
const SHEET_FILE_ID='1nWG0OBGpiyK-lulP-OKGad4jG7uEVmcy';
const META_GID='254048258';
const OPP_GID='1284472120';
const PUBLISHED_META_URL='';
const PUBLISHED_OPP_URL='';

/* ====== HELPERS ====== */
const gvizCsvURL=(fileId,gid)=>`https://docs.google.com/spreadsheets/d/${fileId}/gviz/tq?gid=${encodeURIComponent(gid)}&headers=1&tqx=out:csv`;
function pubCsvURL(pubhtmlUrl){
  const u=new URL(pubhtmlUrl); const parts=u.pathname.split('/'); const idIdx=parts.findIndex(p=>p==='e')+1; const id=parts[idIdx]||'';
  const root=`${u.protocol}//${u.host}${parts.slice(0,idIdx).join('/')}/${id}`;
  return `${root}/pub?gid=${encodeURIComponent(u.searchParams.get('gid')||'0')}&single=true&output=csv`;
}
function parseCSV(text){
  let t=String(text||'').replace(/^\uFEFF/,'').replace(/\r\n?/g,'\n');
  const lines=t.split('\n').filter((ln,i)=>i===0||ln.trim().length>0);
  if(!lines.length) return [];
  const rows=[]; let row=[],cur='',inQ=false;
  const pushCell=()=>{row.push(cur);cur=''}; const pushRow=()=>{rows.push(row);row=[]};
  const s=lines.join('\n');
  for(let i=0;i<s.length;i++){
    const c=s[i],n=s[i+1];
    if(inQ){ if(c=='"'&&n=='"'){cur+='"';i++} else if(c=='"'){inQ=false} else cur+=c }
    else{ if(c=='"') inQ=true; else if(c==',') pushCell(); else if(c=='\n'){pushCell();pushRow()} else cur+=c }
  }
  if(cur!==''||row.length){pushCell();pushRow()}
  const header=(rows.shift()||[]).map(h=>String(h||'').trim());
  return rows.map(r=>Object.fromEntries(header.map((h,i)=>[h, r[i]!==undefined?r[i]:'' ])));
}
async function fetchCsvPrefer(fileId,gid,pubUrl){
  try{ const res=await fetch(gvizCsvURL(fileId,gid),{cache:'no-store'}); if(res.ok){ return parseCSV(await res.text()); } }catch(e){}
  if(pubUrl){ const res=await fetch(pubCsvURL(pubUrl),{cache:'no-store'}); return parseCSV(await res.text()); }
  return [];
}
function normalizeMeta(rows){
  const m=new Map();
  rows.forEach(r=>{
    const k=(''+(r.Key||r.KEY||'')).trim().toLowerCase();
    const v=(''+(r.Value||r.VALORE||'')).trim();
    if(k) m.set(k,v);
  });
  return m;
}
function normalizeOpp(rows){
  const out=new Map();
  rows.forEach(r=>{
    const name=(''+(r.Squadra||r.squadra||'')).trim();
    const url =(''+(r.Logo||r.logo||'')).trim();
    if(name) out.set(name.toLowerCase(), url);
  });
  return out;
}

/* Venue & Maps helpers */
function parseCoords(s){
  if(!s) return null;
  const m = String(s).trim().match(/(-?\d+(?:[.,]\d+)?)\s*[,;\s]\s*(-?\d+(?:[.,]\d+)?)/);
  if(!m) return null;
  const lat = parseFloat(m[1].replace(',', '.'));
  const lon = parseFloat(m[2].replace(',', '.'));
  return (isFinite(lat) && isFinite(lon)) ? {lat, lon} : null;
}
function isGoodMapsLink(url){
  try{
    const u = new URL(url);
    const h = u.hostname.toLowerCase();
    const p = u.pathname.toLowerCase();
    if (h === 'maps.app.goo.gl') return true;
    if (h.endsWith('.google.com') && p.startsWith('/maps')) return true;
    if (h === 'goo.gl' && p.startsWith('/maps')) return true;
    return false;
  }catch{ return false; }
}
function normalizeVenues(rows){
  const out = new Map();
  rows.forEach(r=>{
    const name  = String(r.Squadra || r.squadra || '').trim();
    const campo = String(r.Campo   || r.campo   || r.Venue || r.venue || r.Stadio || '').trim();
    const coord = String(r.Coordinate || r.coordinate || r.Coords || r.coords || r.GPS || '').trim();
    const link  = String(r.Link || r.link || r.Maps || r.maps || r.URL || r.url || '').trim();
    if(!name) return;
    const coords = parseCoords(coord);
    out.set(name.toLowerCase(), {
      venue: campo || '',
      lat: coords?.lat ?? null,
      lon: coords?.lon ?? null,
      link: isGoodMapsLink(link) ? link : ''
    });
  });
  return out;
}
function buildMapsLink({venue, lat, lon, link}) {
  if (link) return link;  // preferisci link condivisibile
  if (venue) return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(venue)}`;
  if (lat != null && lon != null) return `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
  return '#';
}

function slugify(s){ return String(s||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().replace(/&/g,'and').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,''); }
function resolveLogoSrc(teamName, oppMap){
  const name=(teamName||'').trim(); if(!name) return '';
  const fromSheet=oppMap.get(name.toLowerCase())||''; if(fromSheet) return fromSheet;
  return `logos/${slugify(name)}.webp`;
}
function setLogo(imgEl, src, alt){
  if(!src){ imgEl.style.visibility='hidden'; return; }
  imgEl.alt=alt||''; imgEl.crossOrigin='anonymous'; imgEl.src=src;
  imgEl.onload=()=>{ imgEl.style.visibility='visible'; };
  imgEl.onerror=()=>{ imgEl.style.visibility='hidden'; };
}
function fmt2(n){ return String(Math.floor(Math.max(0,n))).padStart(2,'0'); }
function formatOneLine(ms){
  if(ms<=0) return 'LIVE';
  const sec = Math.floor(ms/1000);
  const d = Math.floor(sec/86400);
  const h = Math.floor((sec%86400)/3600);
  const m = Math.floor((sec%3600)/60);
  const s = sec%60;
  return `${fmt2(d)}g ${fmt2(h)}h ${fmt2(m)}m ${fmt2(s)}s`;
}
function formatWhen(dt){
  try{
    return dt.toLocaleString('it-IT', { weekday:'long', day:'2-digit', month:'long', year:'numeric', hour:'2-digit', minute:'2-digit' });
  }catch{ return dt.toString(); }
}
function parseDateTimeIT(dateStr, timeStr){
  const s = String(dateStr||'').trim();
  const t = String(timeStr||'').trim();
  if(!s) return null;
  const combined = s.includes(':') ? s : (t ? `${s} ${t}` : s);
  const m1 = combined.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})(?:[ T](\d{1,2}):(\d{2}))?$/);
  const m2 = combined.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})(?:[ T](\d{1,2}):(\d{2}))?$/);
  let y,M,d,h=15,min=0;
  if(m1){ d=+m1[1]; M=+m1[2]-1; y=+m1[3]; if(m1[4]){h=+m1[4]; min=+m1[5];} }
  else if(m2){ y=+m2[1]; M=+m2[2]-1; d=+m2[3]; if(m2[4]){h=+m2[4]; min=+m2[5];} }
  else return new Date(s);
  return new Date(y,M,d,h,min,0,0);
}

/* ====== INIT ====== */
(async function init(){
  // Pulsanti social
  document.getElementById('igFab').addEventListener('click', ()=>{
    const username='asd_petriolese_calcio';
    const web='https://www.instagram.com/asd_petriolese_calcio/';
    const scheme=`instagram://user?username=${username}`;
    const isMobile=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    if(isMobile){ const start=Date.now(); location.href=scheme; setTimeout(()=>{ if(Date.now()-start<1600) window.open(web,'_blank','noopener'); },700); }
    else{ window.open(web,'_blank','noopener'); }
  }, {passive:true});

  document.getElementById('waFab').addEventListener('click', ()=>{
    const url='https://whatsapp.com/channel/0029Vb6QY82I7BeLPf1qXZ2E';
    window.open(url, '_blank', 'noopener');
  }, {passive:true});

  const shareBtn=document.getElementById('shareFab');
  shareBtn.addEventListener('click', async()=>{
    try{
      shareBtn.setAttribute('aria-busy','true');
      const stage=document.querySelector('.stage'); const prev = shareBtn.style.visibility; shareBtn.style.visibility='hidden';
      const scale=Math.max(3, window.devicePixelRatio||1);
      const canvas=await html2canvas(stage,{backgroundColor:'#0b0c11',scale});
      shareBtn.style.visibility=prev||'visible';
      const out=document.createElement('canvas'); out.width=1080; out.height=1920;
      const ctx=out.getContext('2d'); ctx.fillStyle='#0b0c11'; ctx.fillRect(0,0,out.width,out.height);
      const ratio=Math.min(out.width/canvas.width, out.height/canvas.height);
      const w=Math.round(canvas.width*ratio), h=Math.round(canvas.height*ratio);
      const x=Math.floor((out.width-w)/2), y=Math.floor((out.height-h)/2);
      ctx.drawImage(canvas,x,y,w,h);
      const blob=await new Promise(r=>out.toBlob(r,'image/png',0.95));
      const file=new File([blob], `countdown_petriolese_${new Date().toISOString().slice(0,10)}.png`, {type:'image/png'});
      if(navigator.canShare && navigator.canShare({files:[file]})){ await navigator.share({title:'Countdown ‚Äì Petriolese', files:[file]}); }
      else{ const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=file.name; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }
    }catch(e){ console.error(e); alert('Condivisione non disponibile.'); }
    finally{ shareBtn.removeAttribute('aria-busy'); }
  });

  // Dati dallo Sheet
  const [metaRows, oppRows] = await Promise.all([
    fetchCsvPrefer(SHEET_FILE_ID, META_GID, PUBLISHED_META_URL),
    fetchCsvPrefer(SHEET_FILE_ID, OPP_GID,  PUBLISHED_OPP_URL)
  ]);
  const meta     = normalizeMeta(metaRows);
  const opp      = normalizeOpp(oppRows);      // loghi
  const venuesM  = normalizeVenues(oppRows);   // campo + coords + link

  const squadra1 = (meta.get('squadra1')||'Petriolese').toString().trim() || 'Petriolese';
  const squadra2 = (meta.get('squadra2')||'').toString().trim();
  const dateStr  = (meta.get('data')||meta.get('prossimadata')||meta.get('prossima_data')||'').toString().trim();
  const timeStr  = (meta.get('ora') ||meta.get('prossimaora') ||meta.get('prossima_ora') ||'').toString().trim();
  // === COMPETIZIONE / GIORNATA (sottotitoli) ===
const competizione = (meta.get('competizione')||'').toString().trim();
const giornata     = (meta.get('giornata')||'').toString().trim();
const giorEl = document.getElementById('giornataLine');
const compEl = document.getElementById('compLine');

// reset visibilit√†
if (giorEl) giorEl.hidden = true;
if (compEl) { compEl.hidden = true; compEl.classList.add('small'); } // di default pi√π piccola

if (competizione){
  if (competizione === 'Amichevole'){
    // Mostra solo "Amichevole" sotto al titolo
    if (compEl){
      compEl.textContent = 'Amichevole';
      compEl.hidden = false;
      // per Amichevole va bene la dimensione small
    }
  } else if (competizione === 'Terza Cat. Girone E'){
    // Riga 1: "GIORNATA N" (se N c'√®)
    if (giorEl && giornata){
      giorEl.textContent = `GIORNATA ${giornata}`;
      giorEl.hidden = false;
    }
    // Riga 2 (pi√π piccola): "Terza Cat. Girone E"
    if (compEl){
      compEl.textContent = 'Terza Cat. Girone E';
      compEl.hidden = false;
      compEl.classList.add('small');
    }
  } else {
    // Default: mostra la competizione sotto al titolo
    if (compEl){
      compEl.textContent = competizione;
      compEl.hidden = false;
      // resta small
    }
  }
}

  // Venue: precedenza AVVERSARI (squadra1) ‚Üí fallback Meta
  let venueMeta = (meta.get('luogo')||meta.get('campo')||meta.get('stadio')||meta.get('venue')||'').toString().trim();
  let venue = ''; let lat = null, lon = null; let link = '';
  const vRec = venuesM.get((squadra1||'').toLowerCase());
  if (vRec) { venue = vRec.venue || ''; lat = vRec.lat; lon = vRec.lon; link = vRec.link || ''; }
  if (!venue) venue = venueMeta;

  // VS + loghi
  document.getElementById('t1').textContent = squadra1 || '‚Äî';
  document.getElementById('t2').textContent = squadra2 || '‚Äî';
  setLogo(document.getElementById('logo1'), resolveLogoSrc(squadra1, opp), squadra1);
  setLogo(document.getElementById('logo2'), resolveLogoSrc(squadra2, opp), squadra2);

  // Countdown + auto-redirect a lineup 5' prima
  const dt = parseDateTimeIT(dateStr, timeStr);
  const line = document.getElementById('countdownLine');
  const metaLine = document.getElementById('metaLine');

  // === AUTO-REDIRECT CONFIG ===
  const LINEUP_URL = 'lineup.html';
  const COUNTDOWN_TO_LINEUP = 5 * 60 * 1000; // 5 minuti
  const params = new URLSearchParams(location.search);
  const disableAuto = (params.get('force') === 'countdown'); // override manuale

  function maybeGoLineup() {
    if (!dt || isNaN(+dt) || disableAuto) return;
    const ms = +dt - Date.now();
    if (ms <= COUNTDOWN_TO_LINEUP) {
      location.replace(LINEUP_URL);
    }
  }

  if(dt && !isNaN(+dt)){
    metaLine.textContent = formatWhen(dt); // SOLO data/ora
    // check immediato (se apri gi√† sotto i 5')
    maybeGoLineup();

    const tick = ()=>{
      const ms = +dt - Date.now();
      // appena entri nei 5', vai su lineup
      maybeGoLineup();

      line.textContent = formatOneLine(ms);
      if(ms<=0){ clearInterval(t); line.textContent='LIVE'; }
    };
    tick();
    const t=setInterval(tick, 1000);
  }else{
    line.textContent = '‚Äî';
    metaLine.textContent = 'Imposta Data e Ora nella scheda Meta.';
  }

  // Venue UI (pill + link)
  if (venue) {
    const box = document.getElementById('venueBox');
    const a   = document.getElementById('venueLink');
    a.textContent = venue;
    a.href = buildMapsLink({venue, lat, lon, link});
    a.title = venue;
    box.hidden = false;
  }
})();
</script>

<!-- html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
</body>
</html>
