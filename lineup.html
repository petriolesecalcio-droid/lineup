<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Matchday - Petriolese Calcio</title>
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<style>
  :root{
    --pitch-bottom: 14%;
    --subs-gap:      8%;
    --bg:#0b0c11;
    --roof-dark:#151923;
    --roof-mid:#1f2531;
    --roof-glow:rgba(255,255,255,.08);

    --grass-1:#0a6f20; --grass-2:#0d7f26;

    /* Giocatori / badge */
    --photo-h: 20cqh;
    --badge-w: 17cqh;
    --badge-font: min(1.8cqh, 2.3cqw);
    --badge-overlap: 1.4cqh;

    /* SUBS (elenco) */
    --subs-font:  min(1.6cqh, 2.1cqw);
    --subs-weight: 800;
    --subs-tracking: .18cqw;
    --subs-line: 1.15;
    --subs-transform: uppercase;
    --subs-maxw: calc(100% - 6cqw);
    --subs-font-family: system-ui, Arial, sans-serif;
    --subs-drop: 1cqh;

    /* pennellate */
    --brush-bleed-y: 2cqh;

    /* MATCHDAY */
    --md-w: 88cqw;
    --md-font-top: 3.6cqw;
    --md-font-sub: 2.2cqw;
    --md-splat-bleed: 2.2cqh;

    /* VS */
    --vs-w: 88cqw;
    --vs-logo-h: 10cqh;
    --vs-gap: 2cqw;
    --vs-font: 2.2cqw;
    --vs-letter: .18cqw;

    /* Stack FABs */
    --fab-stack-gap: clamp(8px, 1.6cqw, 12px);
  }

  html,body{height:100%}
  body{
    margin:0; background:var(--bg);
    display:grid; place-items:center;
    font-family:system-ui,Arial,sans-serif;
  }

  .stage{
    position:relative;
    width:min(1200px,96vw);
    aspect-ratio:9/16;
    max-height:96vh;
    overflow:hidden;
    border-radius:18px;
    background:#0b0c11;
    box-shadow:0 25px 80px rgba(0,0,0,.6);
    container-type:size; /* abilita cqw/cqh e @container */
  }

  /* Fondale stadio */
  .stadium{
    position:absolute; inset:0; z-index:0;
    background:
      radial-gradient(1200px 220px at 50% -40px, var(--roof-glow), transparent 60%),
      linear-gradient(to bottom, var(--roof-mid) 0%, var(--roof-dark) 48%, #061007 100%);
  }

  /* Strisce oblique */
  .roof-stripes{ position:absolute; inset:0; z-index:1; pointer-events:none; display:block; }

  /* Campo (SVG con clipPath) */
  .pitch-wrap{
    position:absolute; left:50%; bottom:var(--pitch-bottom); transform:translateX(-50%);
    width:100%; height:75%;
    z-index:2;
  }
  #pitch{ position:absolute; inset:0; width:100%; height:100%; display:block; }

  /* Giocatori */
  .players{
    position:absolute; left:50%; bottom:var(--pitch-bottom); transform:translateX(-50%);
    width:100%; height:75%;
    overflow:visible; pointer-events:none;
    container-type:size; z-index:3;
  }
  .player{ position:absolute; left:0; top:0; transform:translate(-50%, -100%); display:block; overflow:visible; }
  .player .photo{ height: var(--photo-h); width:auto; position:relative; display:block; z-index:1; }

  .badge{
    position:absolute; left:50%; top: calc(100% - var(--badge-overlap));
    transform: translateX(-50%);
    text-transform: uppercase;
    display:flex; align-items:center; justify-content:center;
    width: var(--badge-w); aspect-ratio: 5.5/1;
    font-size: var(--badge-font); font-weight: 900;
    background: url('badge.png?v=6') center/100% auto no-repeat;
    color:#000; white-space:nowrap; line-height:1; pointer-events:none; z-index:2;
  }

  /* MATCHDAY */
  .matchday-badge{
    position:absolute; transform: translate(-50%, -50%);
    width: var(--md-w); aspect-ratio: 5.5/1;
    display:flex; align-items:center; justify-content:center;
    background:none; overflow:visible; pointer-events:none; z-index:4;
  }
  .matchday-badge::before{
    content:""; position:absolute; left:50%; top:50%; transform: translate(-50%,-50%);
    width:100%; height: calc(100% + var(--md-splat-bleed) * 2);
    background: url('md-splat.webp') center / contain no-repeat; z-index:-1; pointer-events:none;
  }
  .matchday-text{ display:flex; flex-direction:column; align-items:center; gap:.35cqh; color:#fff; font-weight:900; text-transform:uppercase; letter-spacing:.22cqw; line-height:1.05; text-align:center; }
  .matchday-text .md-top{ font-size: var(--md-font-top); }
  .matchday-text .md-sub{ font-size: var(--md-font-sub); letter-spacing:.18cqw; }
  .matchday-text .md-comp{ font-size: var(--md-font-sub); letter-spacing:.18cqw; opacity:.95; display:none; }
  @container (max-width: 520px){
    .matchday-text .md-comp{ font-size: clamp(14px, 3.2cqw, 22px); letter-spacing:.16cqw; }
  }

  /* ... resto CSS invariato ... */
</style>
</head>
<body>
  <div class="stage">
    <div class="stadium"></div>
    <svg class="roof-stripes" viewBox="0 0 1000 1778" preserveAspectRatio="none" aria-hidden="true">
      <defs>
        <pattern id="diag" patternUnits="userSpaceOnUse" width="44" height="44" patternTransform="rotate(-10)">
          <rect x="0" y="0" width="44" height="14" fill="#ffffff" opacity="0.06"/>
          <rect x="0" y="14" width="44" height="30" fill="transparent"/>
        </pattern>
      </defs>
      <rect x="0" y="0" width="1000" height="1778" fill="url(#diag)"/>
    </svg>

    <!-- MATCHDAY -->
    <div id="matchdayBadge" class="matchday-badge">
      <div class="matchday-text">
        <div class="md-top">MATCHDAY</div>
        <div class="md-sub" id="mdSub"></div>
        <div class="md-comp" id="mdComp"></div>
      </div>
    </div>

    <!-- resto HTML invariato ... -->
  </div>

<script>
/* ... codice esistente ... */

(async function init(){
  try{
    const [distRows, metaRows, oppRows] = await Promise.all([ fetchDistRows(), fetchMetaRows(), fetchOppRows() ]);
    const byNum = normalizeDist(distRows);

    const meta  = normalizeMeta(metaRows);
    const opp   = normalizeOpp(oppRows);

    const moduloRaw = (meta.get('modulo')||'3412').toString().trim();
    render(byNum, moduloRaw);

    const giornata = (meta.get('giornata')||'').toString().trim();
    const competizione = (meta.get('competizione')||'').toString().trim();

    const mdSubEl  = document.getElementById('mdSub');
    const mdCompEl = document.getElementById('mdComp');

    if (competizione === 'Amichevole'){
      mdSubEl.textContent = 'AMICHEVOLE';
      mdCompEl.style.display = 'none';
    } else if (competizione === 'Terza Cat. Girone E'){
      mdSubEl.textContent = giornata ? `GIORNATA ${giornata}` : '';
      mdCompEl.textContent = 'Terza Cat. Girone E';
      mdCompEl.style.display = '';
    } else {
      mdSubEl.textContent = giornata ? `GIORNATA ${giornata}` : '';
      if (competizione){
        mdCompEl.textContent = competizione;
        mdCompEl.style.display = '';
      } else {
        mdCompEl.style.display = 'none';
      }
    }

    const squadra1 = (meta.get('squadra1')||'').toString().trim() || 'Petriolese';
    const squadra2 = (meta.get('squadra2')||'').toString().trim();
    setLogo(document.getElementById('logo1'), resolveLogoSrc(squadra1, opp), squadra1);
    setLogo(document.getElementById('logo2'), resolveLogoSrc(squadra2, opp), squadra2);
  }catch(e){
    console.error(e);
    render(new Map(), "3412");
  }

  placeSubsByPitch(); placeMatchday(); placeVersus();
  layoutFABs();
})();
</script>
</body>
</html>
